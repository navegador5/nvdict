nv-facutil-basic
===============
- nv-facutil-basic    


install
=======
- npm install nv-facutil-basic 

usage
=====
    
example
-------

    const fac_bsc = require("nv-facutil-basic");

    > fac_bsc.is_node()
    true
    >
    > var d = {a:{b:{c:200}}}

    > fac_bsc.optional_chaining(d,'a','b')
    { c: 200 }
    > fac_bsc.optional_chaining(d,'a','b','e','c')
    undefined
    >
    > fac_bsc.nullish(null,200)
    200
    > fac_bsc.nullish(undefined,200)
    200
    > fac_bsc.nullish(false,200)
    false
    > fac_bsc.nullish(true,200)
    true
    >

    class Cls {
        constructor(){
            this.tag="div"
        }
    }

    function repr(that,stag,etag) {
        return(stag+that.tag+etag)
    }

    fac_bsc.add_repr(Cls,repr,'<','>')
    > var o = new Cls()
    undefined
    > o
    <div>
    >


    > class SomeCls {}
    undefined
    > fac_bsc.add_string_tag(SomeCls,that=>'kkk')
    undefined
    > var o = new SomeCls()
    undefined
    > o
    SomeCls [kkk] {}
    >


    > fac_bsc.creat_id()
    '5055a812-2b24-4c9e-ab11-87088e51203c'
    > fac_bsc.get_abbr('5055a812-2b24-4c9e-ab11-87088e51203c')
    '5055a812'
    >
    
    fac_bsc.creat_reserved(['EPSILON','ε'],['LAMBDA','λ'])
    
    > EPSILON
    'ε'
    > LAMBDA
    'λ'
    > Object.getOwnPropertyDescriptors(global).EPSILON
    { value: 'ε', writable: false, enumerable: false, configurable: false }
    > Object.getOwnPropertyDescriptors(global).LAMBDA
    { value: 'λ', writable: false, enumerable: false, configurable: false }
    >


### iflet

    var a = 3

    var x = iflet(
        a<=1,100,
        a<=2,200,
        300
    )

    >300

### forof

    > var o = {a:100,b:200}
    > for(let e of forof(o)) {console.log(e)}
    [ 100,'a' ]
    [ 200,'b' ]

### forlst
    
    > x.forlst([10,20,30,40],(r,i)=>console.log(r,i))
    40 3
    30 2
    20 1
    10 0
    undefined
    >



### mirror

    > fac_bsc.mirr([11,21,31])
    SimpleMirr(6) [Map] {
      0 => 11,
      11 => 0,
      1 => 21,
      21 => 1,
      2 => 31,
      31 => 2
    }
    > fac_bsc.mirr({a:11,b:21,c:31})
    SimpleMirr(6) [Map] {
      'a' => 11,
      11 => 'a',
      'b' => 21,
      21 => 'b',
      'c' => 31,
      31 => 'c'
    }
    >


### json

    var ary=[[1,2],3,[4,[[6]]]]
    jrplc(d,(r)=>r*2)
    console.log(ary)
    //[[2,4],6,[8,[[12]]]]
    
    var d = {1:100,x:{2:{3:300}}}
    jrplc(d,(r,i,k)=>r+k)
    console.log(d)
    //{ '1': '1001', x: { '2': { '3': '3003' } } }



API
====

- fac\_bsc.is\_node()                                                       //if the runtime is nodejs

- fac\_bsc.add\_repr(Cls,repr\_func,...other\_repr\_func\_args)             //[util.inspect.custom] in nodejs , else .prototype.repr
- fac\_bsc.add\_string\_tag(Cls,repr\_func,...other\_repr\_func\_args)      //get \[Symbol.toStringTag\]() {}


- fac\_bsc.optional\_chaining(obj,...keys)        //same as ?., for api-compatible 
- fac\_bsc.nullish(a,b);                          // same as ?? ,for api-compatible
- fac\_bsc.nc(a,b);                               //same as nullish, for api-compatible


- fac\_bsc.is\_null(o);
- fac\_bsc.is\_undefined(o);
- fac\_bsc.is\_nullish(o);         //null or undefined
- fac\_bsc.is\_nothing(o);         //Nil None nil nullptr NULL empty, refer to CONSTS  

- fac\_bsc.is\_symbol(o) 
- fac\_bsc.is\_bool(o) 
- fac\_bsc.is\_num(o) 
- fac\_bsc.is\_float(o) 
- fac\_bsc.is\_int(o) 
- fac\_bsc.is\_nan(o) 
- fac\_bsc.is\_infinity(o)  
- fac\_bsc.is\_abnormal\_num(o) 
- fac\_bsc.is\_normal\_num(o) 
- fac\_bsc.is\_str(o) 
- fac\_bsc.is\_prim(o) 
- fac\_bsc.is\_bigint(o) 
- fac\_bsc.is\_ary(o) 

- fac\_bsc.is\_u8ary(o)            
- fac\_bsc.is\_buf(o)            //buffer is same as u8ary 
- fac\_bsc.is\_u8cary(o)         //clamped uint8-array
- fac\_bsc.is\_u16ary(o) 
- fac\_bsc.is\_u32ary(o) 
- fac\_bsc.is\_i8ary(o) 
- fac\_bsc.is\_i16ary(o) 
- fac\_bsc.is\_i32ary(o) 
- fac\_bsc.is\_f32ary(o)
- fac\_bsc.is\_f64ary(o) 
- fac\_bsc.is\_bu64ary(o) 
- fac\_bsc.is\_bi64ary(o) 
- fac\_bsc.is\_typed\_ary(o)

- fac\_bsc.is\_set(o) 
- fac\_bsc.is\_map(o) 
- fac\_bsc.is\_wkset(o) 
- fac\_bsc.is\_wkmap(o) 
- fac\_bsc.is\_wkref(o) 
- fac\_bsc.is\_weak(o)

- fac\_bsc.is\_dict(o)      //object NOT  array|typed-array|weak|set|map|cls|func|promise|proxy|
                            //            regex|date|data-view|generator

- fac\_bsc.is\_normal\_dict(o)        //dict but NOT promise| proxy | generator


- fac\_bsc.is\_promise(o)
- fac\_bsc.is\_proxy(o)               //only work in nodejs 
- fac\_bsc.is\_sync\_generator(o)
- fac\_bsc.is\_async\_generator(o)
- fac\_bsc.is\_generator(o)
- fac\_bsc.is\_ppg(o)                    //promise| proxy | generator


- fac\_bsc.is\_regex(o) 
- fac\_bsc.is\_cls\_or\_func(o)  
- fac\_bsc.is\_cls(o)
- fac\_bsc.is\_async\_func(o)
- fac\_bsc.is\_sync\_gen(o)
- fac\_bsc.is\_async\_gen(o)
- fac\_bsc.is\_gen(o)                       //sync\_gen  or async\_gen
- fac\_bsc.is\_normal\_func(o)              //func but NOT gen | async\_func
- fac\_bsc.is\_lambda(o)                    //()=>{} or async()=>{} 
- fac\_bsc.is\_func(o)                      // 
- fac\_bsc.is\_date(o) 
- fac\_bsc.is\_dv(o)                        //dataview
- fac\_bsc.is\_arybuf(o)                    //array-buf



- fac\_bsc.is\_enum\_iter\_leaf(o)      //when typed-array |array |map |set: return true if size/length === 0
                                        //when object : return true if Object.keys(o).length === 0
                                        //others return false

- fac\_bsc.is\_falsy(o)                 // '',0,0n,[],{},and empty Set/Map and empty typed-array
- fac\_bsc.is\_truthy(o)


- fac\_get\_dtype(o)                    //return a string of data-type
                                        //refer to CONSTS DTYPE_NUM
- fac\_get\_dtype\_num(o)               //return a big-int number  of data-type


- fac\_bsc.iflet(cond,rslt,cond,rslt,....else) 
- fac\_bsc.forof(o)                           //if o has [Symbol.iterator] return o, 
                                              //else try for-in and return a generator
                                              //for api-compatible and consistency

- fac\_bsc.creat\_reserved(...kvpairs)       //creat global reserved variables, similar to usage of undefined

- fac\_bsc.creat\_id()                       // if nodejs call crypto.randomUUID, else using nanoid
                                             //nanoid is slightly faster than uuidv4 
- fac\_bsc.get\_abbr(id)                     // the first-8 of a uuid
- fac\_bsc.creat\_bigint\_id()               //convert uuid to a bigint 
- fac\_bsc.creat\_nodash\_id()               //remove dash in uuid
- fac\_bsc.creat\_4int\_id\_ary()            //convert uuid to 4-int-array

- fac\_bsc.SNidPool                          //a int or bigint ID, 
                                             //useful when using adj-table as data structure 

                      
                       //similiar with SNidPool,used in fixed-size scenario;
                       //these are used in fixed-size array-pool ,  
                       // useful when using sharedArrayBuffer,otherwise useless                             
- fac\_bsc.AidPool    //(Array);
- fac\_bsc.T8AidPool  //(Uint8Array);
- fac\_bsc.T16AidPool //(Uint16Array);
- fac\_bsc.T32AidPool //(Uint32Array);
- fac\_bsc.T64AidPool //(BigUint64Array);


- fac\_bsc.jdcp(jsond)         //JSON.parse(JSON.stringify(jsond))
- fac\_bsc.jrplc(jsond,f)      // f: (val,index,key,parent) => {...}
- fac\_bsc.jmap(jsond,f)       // f: (val,index,key,parent) => {...}


- fac\_bsc.unescq(s)           //JSON.parse('"'+s+'"')

- fac\_bsc.typof(o,str);
- fac\_bsc.instof(o,Instance);

- fac\_bsc.eqany(o,...opts);     // opts.includes(o)
                                 // this is used to avoid too many  ===
                                 // coz too-many === will make code unreadable, too long


- fac\_bsc.d2kvlist(d)            // {a:100,b:200} => [['a','b'],[10,200]]
- fac\_bsc.kvlist2d(kl,vl)        // [['a','b'],[10,200]] => {a:100,b:200}
- fac\_bsc.dlngth(d)              // {a:100,b:200} => 2
- fac\_bsc.dsome(d,...ks)         //  dsome({a:100,b:200,c:300},'a','c') => {a:100,c:300}
- fac\_bsc.drekey(d,...ks)        //  drekey({a:100,b:200,c:300},'A','B','C') => {A:100,B:200,C:300}
- fac\_bsc.dreval(d,...vs)        //  dreval({a:100,b:200,c:300},10,20,30) => {a:10,b:20,c:30}


- fac\_bsc.SimpleStack         //Just Array with a  lst(top) setter/getter  to handle last-element
                               //and generator from-last-to-first

- fac\_bsc/SimpleMirr

- fac\_bsc.ary\_lst\_index(ary) {return(ary.length-1)}
- fac\_bsc.ary\_lsti(ary)       //same as ary\_lst\_index

- fac\_bsc.get\_ary\_lst(ary) {return(ary[ary.length-1])}
- fac\_bsc.ary\_glst(ary)      //same as get\_ary\_lst

- fac\_bsc.set\_ary\_lst(ary,v) {ary[ary.length-1] = v}
- fac\_bsc.ary\_slst(ary)      //same as set\_ary\_lst


- fac\_bsc.ary\_ibfr(ary,index,v)   // insert before : ary.splice(index,0,v)
- fac\_bsc.ary\_iaft(ary,index,v)   // insert after  : ary.splice(index+1,0,v)

- fac\_bsc.ary\_rm(ary,index)       // remove at     : ary.splice(index,1)

- fac\_bsc.ary\_fltrg(ary,fltr,not=false)   //Iterator   ,similar as filter, just yield [r,i]
                                    // fltr : (r:any,i:number) => Boolean
                                    // type Entry = [any,number]     //tuple of (r,i)
                                    // type IteratorResult = {done: boolean;value:Entry} 
                                    // type Iterator = {
                                    //    next(value?: any): IteratorResult;            
                                    //    return?(value?: any): IteratorResult;
                                    //    throw?(e?: any): IteratorResult;
                                    //  } 

- fac\_bsc.ary\_freq(ary,v)         // ary=[2,2,3,2,4]      ary\_freq(ary,2)  : 3

- fac\_bsc.ary\_foreach\_brk(arr,f,brkf=(r,i)=\>false)       
- fac\_bsc.ary\_foreach\_skip(arr,f,skipf=(r,i)=\>false)     

CONSTS
======

        > fac_bsc
        {
          ////the below is just for api-compatible when migrating some code from other coding language  
          
          Nil: [class Nil],
          nfunc: [Function: nfunc],
          None: None,
          nil: [Object: null prototype] {},
          nullptr: [Object: null prototype] {},
          NULL: [Object: null prototype] {},
          
          //// the 4 global symbol to avoid conflicting with undefined , just a semantic-undefined

          empty: Symbol(empty),
          unknown: Symbol(unknown),
          impossible: Symbol(impossible),
          maybe: Symbol(maybe),
          any:   Symbol(any),

          ////to avoid conflicting with null, just a semantic-null-sign
          root: Symbol(root)

          //// for add_repr or add_string_tag

          NUL: '\x00',
          NBSP: ' ',
          LS: '�',
          PS: '�',
          ZWNJ: '‌',
          ZWJ: '‍',
          BOM: '',
        }
        >



        STATE_LABEL_DICT: {
          init: Symbol(init),
          ready: Symbol(ready),
          waiting: Symbol(waiting),
          executing: Symbol(executing),
          pending:   Symbol(pending),
          paused:    Symbol(paused),
          skipped:   Symbol(skipped),
          stopped:   Symbol(stopped),
          finished: Symbol(finished),
          resolved: Symbol(resolved),
          rejected: Symbol(rejected)
          eof: Symbol(eof)
        },

        const DTYPE_NUM = {
            'undefined':                                                0b1n,
            'null':                                                    0b10n,
            'symbol':                                                 0b100n,
            'bool':                                                  0b1000n,
            'int':                                                  0b10000n,
            'float':                                               0b100000n,
            'nan':                                                0b1000000n,
            'infinity':                                          0b10000000n,
            'str':                                              0b100000000n,
            'bigint':                                          0b1000000000n,
            'u8ary':                                          0b10000000000n,
            'u8cary':                                        0b100000000000n,
            'u16ary':                                       0b1000000000000n,
            'u32ary':                                      0b10000000000000n,
            'i8ary':                                      0b100000000000000n,
            'i16ary':                                    0b1000000000000000n,
            'i32ary':                                   0b10000000000000000n,
            'f32ary':                                  0b100000000000000000n,
            'f64ary':                                 0b1000000000000000000n,
            'bu64ary':                               0b10000000000000000000n,
            'bi64ary':                              0b100000000000000000000n,
            'ary':                                 0b1000000000000000000000n,
            'set':                                0b10000000000000000000000n,
            'map':                               0b100000000000000000000000n,
            'wkset':                            0b1000000000000000000000000n,
            'wkmap':                           0b10000000000000000000000000n,
            'wkref':                          0b100000000000000000000000000n,
            'regex':                         0b1000000000000000000000000000n,
            'date':                         0b10000000000000000000000000000n,
            'dv':                          0b100000000000000000000000000000n,
            'arybuf':                     0b1000000000000000000000000000000n,
            'sarybuf':                   0b10000000000000000000000000000000n,
            'promise':                  0b100000000000000000000000000000000n,
            'proxy':                   0b1000000000000000000000000000000000n,
            'sync_generator':         0b10000000000000000000000000000000000n,
            'async_generator':       0b100000000000000000000000000000000000n,
            'normal_dict':          0b1000000000000000000000000000000000000n,
            'cls':                 0b10000000000000000000000000000000000000n,
            'sync_gen':           0b100000000000000000000000000000000000000n,
            'async_gen':         0b1000000000000000000000000000000000000000n,
            'async_func':       0b10000000000000000000000000000000000000000n,
            'normal_func':     0b100000000000000000000000000000000000000000n,
        }


        STYPE_DICT: { 
            root: -1, 
            ele: 0,     //element of array
            prop: 1,    //prop of dict
            stele: 2,   //element of set
            mpk: 3,     //key of mp-element
            mpv: 4,     //value of mp-element
            leaf: 5 
        },



LICENSE
=======
- ISC 
